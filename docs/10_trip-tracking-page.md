# صفحة متابعة الرحلات - Trip Tracking Page

## نظرة عامة

صفحة متابعة الرحلات تعرض قائمة بجميع الرحلات مع إمكانية تتبع كل رحلة بشكل مفصل. تتيح هذه الصفحة مقارنة المسار المخطط مع المسار الفعلي، ومراقبة حالة الامتثال للقوانين والقيود، وتتبع تقدم الرحلة في الوقت الفعلي.

## الهدف من الصفحة

- **التعلم**: فهم كيفية تتبع المركبات والرحلات على الخريطة
- **التطبيق العملي**: مراقبة الرحلات في نظام اللوجستيات
- **المراقبة**: متابعة الامتثال للقوانين والسرعة المحددة
- **التحليل**: مقارنة الأداء المخطط مع الفعلي

## المكونات الرئيسية

### 1. قائمة الرحلات

#### معلومات الرحلة الأساسية
- **اسم الرحلة**: معرف فريد للرحلة
- **حالة الرحلة**: مخططة، قيد التنفيذ، مكتملة، متأخرة، ملغية، طوارئ
- **السائق**: اسم السائق المسؤول
- **المركبة**: رقم لوحة المركبة
- **التقدم**: نسبة إنجاز الرحلة

#### حالات الرحلة
```typescript
enum TripStatus {
  PLANNED = 'مخططة',      // 🔵 أزرق
  IN_PROGRESS = 'قيد التنفيذ',  // 🟢 أخضر
  COMPLETED = 'مكتملة',    // 🟢 أخضر فاتح
  DELAYED = 'متأخرة',      // 🟠 برتقالي
  CANCELLED = 'ملغية',     // ⚫ رمادي
  EMERGENCY = 'طوارئ'      // 🔴 أحمر
}
```

### 2. تفاصيل الرحلة المحددة

#### المعلومات الأساسية
- **اسم الرحلة**: الاسم الكامل للرحلة
- **الحالة**: الحالة الحالية مع لون مميز
- **السائق**: اسم السائق وتقييمه
- **المركبة**: رقم اللوحة ونوع المركبة
- **نوع الشحنة**: نوع البضائع المنقولة

#### معلومات المسار
- **من**: نقطة البداية (مطار/ميناء/معبر)
- **إلى**: نقطة النهاية (مطار/ميناء/معبر)
- **المسافة المقطوعة**: بالكيلومتر
- **المسافة المتبقية**: بالكيلومتر
- **السرعة الحالية**: كم/ساعة
- **متوسط السرعة**: كم/ساعة

#### حالة الامتثال
- ✅ **على المسار المحدد**: المركبة تسير في المسار المخطط
- ✅ **السرعة المحددة**: المركبة ملتزمة بالسرعة القصوى
- ✅ **حالة القفل**: أقفال الشاحنة مغلقة بشكل صحيح

#### شريط التقدم
- عرض بصري لنسبة إنجاز الرحلة
- لون الشريط يعكس حالة الرحلة
- نسبة مئوية دقيقة للتقدم

### 3. الخريطة التفاعلية

#### المسارات
- **المسار المخطط**: خط أزرق متقطع يوضح الطريق المخطط
- **المسار الفعلي**: خط سميك يوضح الطريق الفعلي
  - 🟢 أخضر: إذا كانت المركبة على المسار الصحيح
  - 🔴 أحمر: إذا انحرفت المركبة عن المسار

#### العلامات على الخريطة
- 🟢 **نقطة البداية**: علامة خضراء كبيرة
- 🔴 **نقطة النهاية**: علامة حمراء كبيرة
- 🚛 **الموقع الحالي**: علامة المركبة مع معلومات السرعة
- ⚠️ **نقاط التفتيش**: علامات تحذيرية صغيرة

#### ألوان المركبات
- 🟢 **أخضر**: مركبة ملتزمة (سرعة + مسار + قفل)
- 🔴 **أحمر**: مركبة غير ملتزمة (مخالفة واحدة أو أكثر)

## الميزات التفاعلية

### 1. التحديث التلقائي
- ☑️ **تحديث تلقائي**: تحديث البيانات كل 5 ثوان
- تحديث موقع المركبة في الوقت الفعلي
- تحديث حالة الامتثال والإحصائيات

### 2. اختيار الرحلة
- النقر على رحلة في القائمة لعرض تفاصيلها
- تمييز الرحلة المحددة بلون مختلف
- تركيز الخريطة على الرحلة المحددة

### 3. عرض متعدد الرحلات
- عند عدم تحديد رحلة: عرض جميع الرحلات النشطة
- النقر على مركبة في الخريطة لتحديد رحلتها
- تبديل سهل بين الرحلات

## التقنيات المستخدمة

### 1. هياكل البيانات المعقدة

```typescript
interface Trip {
  id: string;
  name: string;
  status: TripStatus;
  driver: Driver;
  vehicle: Vehicle;
  cargo: Cargo;
  
  // المسار
  origin: EntryPoint;
  destination: EntryPoint;
  plannedRoute: LatLng[];
  actualRoute: LatLng[];
  checkpoints: Checkpoint[];
  
  // التوقيتات
  plannedStartTime: Date;
  actualStartTime?: Date;
  plannedEndTime: Date;
  estimatedArrival: Date;
  
  // المراقبة
  currentLocation: LatLng;
  isOnRoute: boolean;
  speedCompliance: boolean;
  lockCompliance: boolean;
  lastUpdate: Date;
  
  // الإحصائيات
  distanceTraveled: number;
  remainingDistance: number;
  averageSpeed: number;
  fuelConsumption: number;
}
```

### 2. التحديث في الوقت الفعلي

```typescript
useEffect(() => {
  let interval: NodeJS.Timeout;
  if (autoRefresh) {
    interval = setInterval(() => {
      loadTrips();
      if (selectedTrip) {
        logisticsApi.getTripById(selectedTrip.id).then(trip => {
          if (trip) setSelectedTrip(trip);
        });
      }
    }, 5000);
  }
  return () => {
    if (interval) clearInterval(interval);
  };
}, [autoRefresh, selectedTrip]);
```

### 3. حساب التقدم

```typescript
const calculateProgress = (trip: Trip): number => {
  const total = trip.distanceTraveled + trip.remainingDistance;
  return total > 0 ? (trip.distanceTraveled / total) * 100 : 0;
};
```

### 4. تحديد لون المركبة

```typescript
const getVehicleIcon = (trip: Trip): string => {
  if (!trip.speedCompliance || !trip.lockCompliance || !trip.isOnRoute) {
    return 'https://maps.google.com/mapfiles/ms/icons/red-dot.png';
  }
  return 'https://maps.google.com/mapfiles/ms/icons/green-dot.png';
};
```

## دليل الألوان والرموز

### المسارات
- 🔵 **خط متقطع أزرق**: المسار المخطط
- 🟢 **خط أخضر سميك**: المسار الفعلي (ملتزم)
- 🔴 **خط أحمر سميك**: المسار الفعلي (منحرف)

### المركبات
- 🟢 **نقطة خضراء**: مركبة ملتزمة بجميع القوانين
- 🔴 **نقطة حمراء**: مركبة مخالفة لقانون أو أكثر
- ⚠️ **رمز تحذير**: نقطة تفتيش

### النقاط
- 🟢 **نقطة خضراء كبيرة**: نقطة البداية
- 🔴 **نقطة حمراء كبيرة**: نقطة النهاية

### الامتثال
- ✅ **علامة صح**: ملتزم
- ❌ **علامة خطأ**: غير ملتزم

## حالات الاستخدام

### 1. مراقب العمليات
- متابعة جميع الرحلات النشطة
- تحديد الرحلات المتأخرة أو المخالفة
- اتخاذ إجراءات فورية عند الحاجة

### 2. مدير الأسطول
- مراقبة أداء السائقين
- تحسين المسارات والجدولة
- متابعة استهلاك الوق��د والكفاءة

### 3. خدمة العملاء
- تقديم معلومات دقيقة عن موقع الشحنة
- تحديث العملاء بالتأخيرات المتوقعة
- تتبع حالة التسليم

### 4. الامتثال والسلامة
- مراقبة الالتزام بالسرعة المحددة
- التأكد من سلامة الأقفال
- متابعة الالتزام بالمسارات المحددة

## الفوائد التعليمية

### 1. إدارة الحالة المعقدة
- التعامل مع بيانات متعددة الطبقات
- إدارة التحديثات في الوقت الفعلي
- تنسيق البيانات بين مكونات مختلفة

### 2. التصور البصري للبيانات
- عرض المسارات على الخريطة
- استخدام الألوان للتمييز بين الحالات
- إنشاء مؤشرات بصرية للتقدم

### 3. التفاعل المتقدم
- التبديل بين عروض مختلفة
- التحديث التلقائي للبيانات
- التفاعل مع عناصر الخريطة

### 4. معالجة البيانات الزمنية
- حساب الأوقات والمدد
- تنسيق التواريخ والأوقات
- مقارنة الأوقات المخططة مع الفعلية

## التطوير المستقبلي

### 1. ميزات متقدمة
- **التنبؤ بالتأخير**: استخدام الذكاء الاصطناعي
- **التحسين التلقائي**: اقتراح مسارات بديلة
- **التنبيهات الذكية**: تنبيهات مخصصة حسب الأولوية
- **التقارير التفصيلية**: تحليل الأداء والكفاءة

### 2. تحسينات الأداء
- **التحميل التدريجي**: تحميل البيانات حسب الحاجة
- **ضغط البيانات**: تقليل حجم البيانات المنقولة
- **التخزين المؤقت الذكي**: حفظ البيانات المهمة محلياً

### 3. التكامل المتقدم
- **أجهزة الاستشعار**: ربط مع أجهزة GPS وأجهزة الاستشعار
- **أنظمة ERP**: تكامل مع أنظمة إدارة الموارد
- **التطبيقات المحمولة**: تطبيق للسائقين والعملاء

## الخلاصة

صفحة متابعة الرحلات توفر نموذجاً شاملاً لفهم:
- تتبع المركبات والرحلات في الوقت الفعلي
- مقارنة الأداء المخطط مع الفعلي
- مراقبة الامتثال للقوانين والقيود
- إنشاء واجهات تفاعلية معقدة
- إدارة البيانات المتغيرة باستمرار

هذه المفاهيم أساسية لبناء أنظمة إدارة الأساطيل المتقدمة وتطبيقات اللوجستيات الذكية.